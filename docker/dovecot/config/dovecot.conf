# Dovecot configuration for KoeMail

# Base configuration
protocols = imap pop3 lmtp sieve
listen = *, ::
log_path = /dev/stdout
info_log_path = /dev/stdout
debug_log_path = /dev/stdout

# SSL Configuration - optional (commented out for basic setup)
#ssl = required
#ssl_cert = </etc/ssl/certs/mail/fullchain.pem
#ssl_key = </etc/ssl/certs/mail/privkey.pem
#ssl_min_protocol = TLSv1.2

# For now, allow plain text auth for testing
disable_plaintext_auth = no

# Authentication
auth_mechanisms = plain login
auth_username_format = %Ln

# Include auth configuration
!include conf.d/auth-sql.conf.ext

# Mail location
mail_location = maildir:/var/mail/%d/%n
mail_uid = 1000
mail_gid = 1000
first_valid_uid = 1000
last_valid_uid = 1000

# Default namespace
namespace inbox {
  type = private
  separator = /
  prefix = 
  location = 
  inbox = yes
  hidden = no
  list = yes
  subscriptions = yes
}

# IMAP service
service imap-login {
  inet_listener imap {
    port = 143
  }
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

service imap {
  process_limit = 1024
}

# POP3 service
service pop3-login {
  inet_listener pop3 {
    port = 110
  }
  inet_listener pop3s {
    port = 995
    ssl = yes
  }
}

service pop3 {
  process_limit = 1024
}

# LMTP service for local delivery
service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    group = postfix
    mode = 0600
    user = postfix
  }
}

# Authentication service
service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0666
    user = postfix
    group = postfix
  }

  unix_listener auth-userdb {
    mode = 0600
    user = vmail
    group = vmail
  }

  user = dovecot
}

service auth-worker {
  user = vmail
}

# Protocol-specific settings
protocol imap {
  mail_plugins = 
}

protocol pop3 {
  mail_plugins = 
}

protocol lmtp {
  mail_plugins = 
}